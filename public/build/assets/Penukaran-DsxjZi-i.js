import{r as a,j as e}from"./app-BEUeqneF.js";import{d as y}from"./index-DCD6GPHE.js";import{H as u}from"./html5-qrcode-scanner-CHIl-nE4.js";function q({penukaran:t}){var f,w,j,b,N;const[d,g]=a.useState(""),[o,h]=a.useState(!1),[n,I]=a.useState([]),[z,C]=a.useState(null),m=a.useRef(null),r=a.useRef(null),[M,v]=a.useState(!1);a.useEffect(()=>{if(!d.trim())return;const s=setTimeout(()=>{v(!0),y.Inertia.get(route("admin-air.penukarans.index"),{id:d.trim()},{preserveState:!0,replace:!0,only:["penukaran"],onFinish:()=>v(!1)})},500);return()=>clearTimeout(s)},[d]);const p=async s=>{g(s),await c(),h(!1)},H=async()=>{const s=new u(m.current.id);r.current=s;const l=await u.getCameras();if(l.length===0)return alert("Tidak ada kamera");const i=l[0].id;await s.start({deviceId:{exact:i}},{fps:10,qrbox:{width:250,height:250},aspectRatio:1},x=>p(x.trim()))},c=async()=>{r.current&&(await r.current.stop(),await r.current.clear(),r.current=null)};a.useEffect(()=>(o&&H(),()=>c()),[o]);const k=()=>{if(n.length<=1)return;const s=n.findIndex(i=>i.id===z),l=n[(s+1)%n.length];C(l.id),c().then(()=>{const i=new u(m.current.id);r.current=i,i.start({deviceId:{exact:l.id}},{fps:10,qrbox:{width:250,height:250}},x=>p(x.trim()))})},S=()=>{if(!t)return;const s=t.status==="sudah diredeem"?"belum diredeem":"sudah diredeem";y.Inertia.put(route("admin-air.penukarans.status",t.id),{status:s})};return e.jsxs("div",{className:"mx-auto w-full max-w-[500px] min-h-screen bg-white",children:[e.jsxs("div",{className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-20 bg-main",children:[e.jsxs("div",{className:"flex items-center px-4 py-2 space-x-4 bg-main",children:[e.jsx("button",{onClick:()=>window.history.back(),className:"w-6 h-6 shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",viewBox:"0 0 24 24",className:"w-6 h-6",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("div",{className:"text-white font-bold text-lg font-utama",children:"Kelola Penukaran"})]}),e.jsx("div",{className:"sticky top-[44px] z-10 bg-white shadow px-4 py-3 border-b border-gray-200",children:e.jsx("div",{className:"flex space-x-4 items-center",children:e.jsxs("div",{className:"flex-grow h-9 flex items-center pr-2 py-2 rounded-lg bg-neutral-100 border-2 border-gray-200",children:[e.jsx("input",{type:"text",placeholder:"Masukkan id voucher...",value:d,onChange:s=>g(s.target.value),className:"bg-transparent border-none flex-grow text-sm focus:ring-0 focus:outline-none placeholder-gray-400"}),e.jsx("button",{onClick:()=>h(!0),className:"text-main",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"w-5 h-5",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5M.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5M4 4h1v1H4z"}),e.jsx("path",{d:"M7 2H2v5h5zM3 3h3v3H3zm2 8H4v1h1z"}),e.jsx("path",{d:"M7 9H2v5h5zm-4 1h3v3H3zm8-6h1v1h-1z"}),e.jsx("path",{d:"M9 2h5v5H9zm1 1v3h3V3zM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8zm2 2H9V9h1zm4 2h-1v1h-2v1h3zm-4 2v-1H8v1z"}),e.jsx("path",{d:"M12 9h2V8h-2z"})]})})]})})})]}),e.jsxs("div",{className:"pt-[120px] px-4 pb-6",children:[o&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-80 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-lg relative w-full max-w-sm mx-4 p-4 flex flex-col items-center",children:[e.jsx("div",{ref:m,id:"qr-reader",className:"w-full aspect-square bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[n.length>1&&e.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded-lg",children:"Flip Camera"}),e.jsx("button",{onClick:()=>{c(),h(!1)},className:"px-4 py-2 bg-red-500 text-white rounded-lg",children:"Tutup"})]})]})}),M?e.jsx("p",{className:"text-center text-gray-400 italic",children:"Memuat data..."}):t?e.jsxs("div",{className:"border p-4 rounded-lg bg-white shadow-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-main font-semibold text-lg",children:[e.jsxs("svg",{className:"w-5 h-5 text-main",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.1 0-2 .9-2 2v4h4v-4c0-1.1-.9-2-2-2z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m0 14v1m8-8h1M4 12H3m15.364-5.364l.707.707M6.343 17.657l-.707.707m12.728 0l.707-.707M6.343 6.343l-.707-.707"})]}),(f=t.voucher)==null?void 0:f.nama]}),e.jsx("span",{className:`text-xs text-center font-medium px-2 py-0.5 rounded-full
                            ${t.status==="sudah diredeem"?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}
                            `,children:t.status})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 16 16",className:"w-4 h-4 text-yellow-500",children:e.jsx("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.5 4.002V12h1.283V9.164h1.668C10.033 9.164 11 8.08 11 6.586c0-1.482-.955-2.584-2.538-2.584zm2.77 4.072c.893 0 1.419-.545 1.419-1.488s-.526-1.482-1.42-1.482H6.778v2.97z"})}),t.poin_dipakai," Poin"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"w-4 h-4 mr-1 text-blue-500",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"})}),e.jsxs("a",{href:route("admin.manage-users.show",(w=t.user)==null?void 0:w.id),className:"text-main hover:underline hover:text-blue-700 transition",children:[(j=t.user)==null?void 0:j.name," (",(b=t.user)==null?void 0:b.rt,"/",(N=t.user)==null?void 0:N.rw,")"]})]}),e.jsx("button",{className:`w-full mt-2 px-4 py-2 rounded-md text-sm font-medium transition flex items-center justify-center gap-2 ${t.status==="sudah diredeem"?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-teal-500 hover:bg-teal-600 text-white"}`,disabled:t.status==="sudah diredeem",onClick:S,children:t.status==="sudah diredeem"?`Terpakai pada: ${new Date(t.updated_at).toLocaleString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}`:"Redeem Voucher"})]}):e.jsx("p",{className:"text-center text-gray-500",children:"Silakan scan QR atau masukkan ID voucher."})]})]})}export{q as default};
