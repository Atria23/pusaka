import{r,j as e}from"./app-DzKhxDEK.js";import{d as $}from"./index-C3MeXTo1.js";function Q({produkOlahan:K,sampah:l}){const[n,d]=r.useState({id:null,nama_produk:"",sampah_id:"",foto:null,link_pembelian:""}),u=r.useRef(null),[z,j]=r.useState(null),[p,M]=r.useState(!1),[F,k]=r.useState(!1),[y,A]=r.useState(null),[N,D]=r.useState(""),[f,I]=r.useState(""),[g,b]=r.useState(""),[O,m]=r.useState(!1),[c,T]=r.useState("asc"),[i,_]=r.useState(1),C=10,S=r.useRef(null),V=a=>{var t;d({id:a.id,nama_produk:a.nama_produk,sampah_id:a.sampah_id,foto:null,link_pembelian:a.link_pembelian||""}),j(a.foto?`/storage/${a.foto}`:null),M(!0),k(!0),b(((t=l.find(s=>s.id===a.sampah_id))==null?void 0:t.nama_sampah)||""),u.current&&(u.current.value=null)},L=()=>{d({id:null,nama_produk:"",sampah_id:"",foto:null}),M(!1),j(null),k(!1),b(""),m(!1),u.current&&(u.current.value=null)},w=a=>{const{name:t,value:s,files:h}=a.target;if(t==="foto"){const o=h[0];d(x=>({...x,foto:o})),j(URL.createObjectURL(o))}else if(t==="searchKategori")b(s),m(!0),d(o=>({...o,sampah_id:""}));else{let o=s;t==="link_pembelian"&&o&&!/^https?:\/\//i.test(o)&&(o="https://"+o),d(x=>({...x,[t]:o}))}},U=a=>{if(a.preventDefault(),!n.sampah_id){alert("Kategori sampah harus dipilih dari daftar.");return}const t=new FormData;t.append("nama_produk",n.nama_produk),t.append("sampah_id",n.sampah_id),t.append("link_pembelian",n.link_pembelian||""),n.foto instanceof File&&t.append("foto",n.foto);const s=p?route("admin.produk-olahan.update",n.id):route("admin.produk-olahan.store");p&&t.append("_method","PUT"),$.Inertia.post(s,t,{forceFormData:!0,onSuccess:()=>L(),onError:h=>console.error(h)})},q=a=>{confirm("Yakin ingin menghapus produk ini?")&&$.Inertia.delete(route("admin.produk-olahan.destroy",a))},E=r.useMemo(()=>K.filter(a=>{const t=a.nama_produk.toLowerCase(),s=l.find(W=>W.id===a.sampah_id),h=(s==null?void 0:s.nama_sampah.toLowerCase())||"",o=N.toLowerCase(),x=t.includes(o)||h.includes(o),G=f?a.sampah_id.toString()===f.toString():!0;return x&&G}),[N,f,K,l]),B=r.useMemo(()=>{const a=[...E];return a.sort((t,s)=>t.nama_produk<s.nama_produk?c==="asc"?-1:1:t.nama_produk>s.nama_produk?c==="asc"?1:-1:0),a},[E,c]),v=Math.ceil(B.length/C),R=B.slice((i-1)*C,i*C),P=a=>{a<1||a>v||_(a)},H=r.useMemo(()=>{if(!g.trim())return l;const a=g.toLowerCase();return l.filter(t=>t.nama_sampah.toLowerCase().includes(a))},[g,l]),Z=a=>{b(a.nama_sampah),d(t=>({...t,sampah_id:a.id})),m(!1)};return r.useEffect(()=>{function a(t){S.current&&!S.current.contains(t.target)&&m(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),e.jsxs("div",{className:"mx-auto w-full max-w-[500px] min-h-screen bg-white",children:[e.jsx("div",{className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-20 bg-main",children:e.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 justify-start items-center px-4 py-2 bg-main",children:[e.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 items-center justify-start",children:[e.jsx("button",{className:"shrink-0 w-6 h-6",onClick:()=>window.history.back(),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"white",className:"w-6 h-6",children:e.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),e.jsx("div",{className:"font-utama text-white font-bold text-lg",children:"Kelola Produk Olahan"})]}),e.jsx("button",{onClick:()=>{L(),k(!0)},className:"flex items-center w-6 h-6",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6 text-white",children:[e.jsx("path",{d:"M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2m0 18a8 8 0 1 1 8-8 8.01 8.01 0 0 1-8 8"}),e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4z"})]})})]})}),F&&e.jsxs("form",{onSubmit:U,className:"sticky top-12 z-20 bg-white px-4 py-4 shadow-sm rounded-b-lg space-y-4 max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:p?"Edit Produk Olahan":"Tambah Produk Olahan"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nama_produk",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Nama Produk"}),e.jsx("input",{type:"text",id:"nama_produk",name:"nama_produk",value:n.nama_produk,onChange:w,placeholder:"Nama Produk",required:!0,className:"input w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-main bg-white"})]}),e.jsxs("div",{ref:S,className:"relative",children:[e.jsx("label",{htmlFor:"searchKategori",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Cari dan pilih kategori sampah"}),e.jsx("input",{type:"text",id:"searchKategori",name:"searchKategori",value:g,onChange:w,onFocus:()=>m(!0),placeholder:"Ketik kategori sampah...",required:!0,autoComplete:"off",className:"input w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-main bg-white cursor-pointer"}),O&&H.length>0&&e.jsx("div",{className:"absolute w-full mt-1 max-h-40 overflow-y-auto bg-white border border-gray-300 rounded-md shadow z-30",children:H.map(a=>e.jsx("div",{onClick:()=>Z(a),className:"px-3 py-2 text-sm hover:bg-gray-100 cursor-pointer",children:a.nama_sampah},a.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"foto",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Foto Produk"}),e.jsx("input",{type:"file",id:"foto",name:"foto",accept:"image/*",ref:u,onChange:w,className:"w-full"}),z&&e.jsx("img",{src:z,alt:"Preview",className:"mb-3 mx-auto max-h-48 object-contain rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link Pembelian (opsional)"}),e.jsx("input",{type:"url",name:"link_pembelian",value:n.link_pembelian,onChange:w,className:"input w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-main bg-white",placeholder:"https://"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",className:"flex-1 py-3 rounded-lg font-semibold text-white bg-main hover:bg-main/90 transition",children:p?"Update":"Simpan"}),e.jsx("button",{type:"button",onClick:L,className:"flex-1 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-100 transition",children:"Batal"})]})]}),e.jsxs("div",{className:`sticky top-[44px] flex flex-col space-y-2 z-10 bg-white shadow px-4 py-3 border-b border-gray-200 ${F?"hidden":""}`,children:[e.jsxs("div",{className:"flex space-x-4 items-center",children:[e.jsxs("div",{className:"flex-grow h-9 flex flex-row items-center justify-center pr-2 py-2 rounded-lg bg-neutral-100 border-2 border-gray-200",children:[e.jsx("input",{type:"text",placeholder:"Cari produk atau kategori...",value:N,onChange:a=>{D(a.target.value),_(1)},className:"bg-transparent border-none flex-grow focus:ring-0 focus:outline-none text-sm placeholder-gray-400"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"0.3",className:"w-5 h-5 text-main",children:e.jsx("path",{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14A4.5 4.5 0 1 1 14 9.5 4.505 4.505 0 0 1 9.5 14z"})})]}),e.jsx("button",{onClick:()=>T(c==="asc"?"desc":"asc"),className:"flex items-center space-x-1 text-sm text-gray-700 hover:text-main transition",title:`Sort nama produk ${c==="asc"?"A-Z":"Z-A"}`,children:c==="asc"?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"w-6 h-6 text-main",viewBox:"0 0 16 16",children:[e.jsx("path",{fillRule:"evenodd",d:"M10.082 5.629 9.664 7H8.598l1.789-5.332h1.234L13.402 7h-1.12l-.419-1.371zm1.57-.785L11 2.687h-.047l-.652 2.157z"}),e.jsx("path",{d:"M12.96 14H9.028v-.691l2.579-3.72v-.054H9.098v-.867h3.785v.691l-2.567 3.72v.054h2.645zM4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"w-6 h-6 text-main",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M12.96 7H9.028v-.691l2.579-3.72v-.054H9.098v-.867h3.785v.691l-2.567 3.72v.054h2.645z"}),e.jsx("path",{fillRule:"evenodd",d:"M10.082 12.629 9.664 14H8.598l1.789-5.332h1.234L13.402 14h-1.12l-.419-1.371zm1.57-.785L11 9.688h-.047l-.652 2.156z"}),e.jsx("path",{d:"M4.5 2.5a.5.5 0 0 0-1 0v9.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L4.5 12.293z"})]})})]}),e.jsxs("select",{value:f,onChange:a=>{I(a.target.value),_(1)},className:"w-full h-9 px-3 rounded-lg border border-gray-300 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-main",children:[e.jsx("option",{value:"",children:"Semua Kategori"}),l.map(a=>e.jsx("option",{value:a.id,children:a.nama_sampah},a.id))]})]}),e.jsx("div",{className:"p-4 grid grid-cols-1 gap-4 mt-12",children:R.length>0?R.map(a=>{var t,s;return e.jsx("div",{className:"flex flex-col bg-white rounded-lg shadow p-4 space-y-3",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center overflow-hidden",children:a.foto?e.jsx("img",{src:`/storage/${a.foto}`,alt:a.nama_produk,className:"w-16 h-16 object-cover"}):e.jsx("div",{className:"text-xs text-gray-500",children:"No Image"})}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>A(y===a.id?null:a.id),children:[e.jsx("div",{className:`font-semibold text-base text-gray-800 ${y===a.id?"break-words":"line-clamp-3"} max-w-[20vw]`,title:a.nama_produk,children:a.nama_produk}),e.jsx("div",{className:`text-sm text-gray-600 ${y===a.id?"break-words":"line-clamp-2"} max-w-[20vw]`,title:((t=a.sampah)==null?void 0:t.nama_sampah)||"Tanpa Kategori",children:((s=a.sampah)==null?void 0:s.nama_sampah)||"Tanpa Kategori"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>V(a),className:"text-xs text-yellow-700 bg-yellow-200 hover:bg-yellow-300 px-2 py-1 rounded-xl transition",children:"Edit"}),e.jsx("button",{onClick:()=>q(a.id),className:"text-xs text-red-700 bg-red-200 hover:bg-red-300 px-2 py-1 rounded-xl transition",children:"Hapus"})]})]})},a.id)}):e.jsx("p",{className:"p-4 text-center text-gray-500",children:"Belum ada produk olahan."})}),v>1&&e.jsxs("div",{className:"flex justify-center space-x-2 pb-8",children:[e.jsx("button",{onClick:()=>P(i-1),disabled:i===1,className:"px-3 py-1 rounded border border-gray-300 disabled:opacity-50",children:"Prev"}),[...Array(v).keys()].map((a,t)=>{const s=t+1;return e.jsx("button",{onClick:()=>P(s),className:`px-3 py-1 rounded border ${i===s?"bg-main text-white border-main":"border-gray-300"}`,children:s},s)}),e.jsx("button",{onClick:()=>P(i+1),disabled:i===v,className:"px-3 py-1 rounded border border-gray-300 disabled:opacity-50",children:"Next"})]})]})}export{Q as default};
