import{q as xe,W as he,r,j as a,d as pe,y as Q}from"./app-hMjON_fH.js";function we(){const{sampahList:C=[],setoranList:_=[],users:A=[]}=xe().props,{data:g,setData:l,post:X,reset:ee}=he({user_id:"",sampah_id:"",berat:""}),[B,ae]=r.useState(null),[L,f]=r.useState(""),[D,b]=r.useState(""),[H,m]=r.useState(!1),[w,te]=r.useState(""),[o,$]=r.useState(1),M=20,[ge,E]=r.useState(!1),[fe,R]=r.useState(!1),[F,v]=r.useState(!1),[P,j]=r.useState(!1),u=r.useRef(null),x=r.useRef(null),h=r.useRef(null),[U,V]=r.useState(null),[y,N]=r.useState({berat_dalam_kg:""}),se=e=>{V(e.id),N({berat_dalam_kg:e.berat_dalam_kg})},re=()=>{V(null),N({berat_dalam_kg:""})},ne=e=>{Q.put(`/admin/setoran/${e}`,y,{onSuccess:()=>{V(null),N({berat_dalam_kg:""})},onError:t=>{console.log("Edit Error:",t),alert("Gagal menyimpan perubahan.")}})},le=e=>{confirm("Yakin ingin menghapus setoran ini?")&&Q.delete(`/admin/setoran/${e}`,{onSuccess:()=>{},onError:()=>{alert("Gagal menghapus setoran.")}})},[z,oe]=r.useState("desc"),W=F?A.filter(e=>L===""||e.name.toLowerCase().includes(L.toLowerCase())):[],K=P?C.filter(e=>D===""||e.nama_sampah.toLowerCase().includes(D.toLowerCase())):[];r.useEffect(()=>{function e(t){u.current&&!u.current.contains(t.target)&&v(!1),x.current&&!x.current.contains(t.target)&&j(!1),h.current&&!h.current.contains(t.target)&&m(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const ie=e=>{e.preventDefault(),!S&&(O(!0),X("/admin/setoran",{onSuccess:()=>{ee(),f(""),b(""),m(!1),$(1),E(!1),R(!1)},onError:()=>{},onFinish:()=>{O(!1)}}))},de=()=>{const e=C.find(s=>s.id===parseInt(g.sampah_id));if(!e||!g.berat)return 0;const t=parseFloat(g.berat)/1e3;return Math.floor(t*e.harga_per_kg)};r.useEffect(()=>{function e(t){u.current&&u.current.contains(t.target),x.current&&x.current.contains(t.target),h.current&&!h.current.contains(t.target)&&m(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const T=r.useMemo(()=>{if(!w)return _;const e=w.toLowerCase();return _.filter(t=>{var i,d,c,p;const s=((d=(i=t.user)==null?void 0:i.name)==null?void 0:d.toLowerCase())??"",n=((p=(c=t.sampah)==null?void 0:c.nama_sampah)==null?void 0:p.toLowerCase())??"";return s.includes(e)||n.includes(e)})},[w,_]),ce=[...T].sort((e,t)=>{const s=new Date(e.tanggal),n=new Date(t.tanggal);return z==="asc"?s-n:n-s}),k=Math.ceil(T.length/M),q=ce.slice((o-1)*M,o*M),I=e=>{e<1||e>k||$(e)},G=e=>new Intl.NumberFormat("id-ID",{}).format(e),me=e=>{const t=new Date(e),s=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getFullYear()).slice(2),d=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return`${s}/${n}/${i}, ${d}.${c}`},[S,O]=r.useState(!1);return a.jsxs("div",{className:"mx-auto w-full max-w-[500px] min-h-screen bg-white",children:[a.jsx("div",{className:"fixed top-0 left-1/2 -translate-x-1/2 max-w-[500px] w-full z-20 bg-main",children:a.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 justify-start items-center px-4 py-2 bg-main",children:[a.jsxs("div",{className:"w-full h-max flex flex-row space-x-4 items-center justify-start",children:[a.jsx("button",{className:"shrink-0 w-6 h-6",onClick:()=>window.history.back(),children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"white",className:"w-6 h-6",children:a.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),a.jsx("div",{className:"font-utama text-white font-bold text-lg",children:"Setoran Sampah"})]}),a.jsx("button",{onClick:()=>m(e=>!e),className:"flex items-center w-6 h-6",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6 text-white",children:[a.jsx("path",{d:"M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2m0 18a8 8 0 1 1 8-8 8.01 8.01 0 0 1-8 8"}),a.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4z"})]})})]})}),H&&a.jsxs("form",{ref:h,onSubmit:ie,className:"sticky top-12 z-20 bg-white px-4 py-4 shadow-sm rounded-b-lg space-y-4",children:[a.jsxs("div",{ref:u,className:"relative",children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"User:"}),a.jsx("input",{type:"text",value:L,onFocus:()=>{f(""),l("user_id",""),E(!1),v(!0)},onChange:e=>{f(e.target.value),v(!0);const t=A.find(s=>`${s.name}_${s.rt}_${s.rw}_${s.kontak}`.toLowerCase()===e.target.value.toLowerCase()||s.name.toLowerCase()===e.target.value.toLowerCase());l("user_id",t?t.id:"")},onKeyDown:e=>{e.key==="Enter"&&e.preventDefault()},className:"input w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-main bg-white cursor-pointer",placeholder:"Ketik nama user...",autoComplete:"off",required:!0}),F&&W.length>0&&a.jsx("div",{className:"absolute w-full mt-1 max-h-40 overflow-y-auto bg-white border border-gray-300 rounded-md shadow z-30",children:W.map(e=>a.jsxs("div",{onClick:()=>{const t=`${e.name} (RT ${e.rt}/RW ${e.rw}) - ${e.kontak}`;f(t),l("user_id",e.id),E(!0),v(!1)},className:"px-3 py-2 text-sm hover:bg-gray-100 cursor-pointer",children:[e.name," (RT ",e.rt," / RW ",e.rw,") - ",e.kontak]},e.id))})]}),a.jsxs("div",{ref:x,className:"relative",children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Jenis Sampah:"}),a.jsx("input",{type:"text",value:D,onFocus:()=>{b(""),l("sampah_id",""),R(!1),j(!0)},onChange:e=>{b(e.target.value),j(!0);const t=C.find(s=>s.nama_sampah.toLowerCase()===e.target.value.toLowerCase());l("sampah_id",t?t.id:"")},onKeyDown:e=>{e.key==="Enter"&&e.preventDefault()},className:"input w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-main bg-white cursor-pointer",placeholder:"Ketik jenis sampah...",autoComplete:"off",required:!0}),P&&K.length>0&&a.jsx("div",{className:"absolute w-full mt-1 max-h-40 overflow-y-auto bg-white border border-gray-300 rounded-md shadow z-30",children:K.map(e=>a.jsx("div",{onClick:()=>{b(e.nama_sampah),l("sampah_id",e.id),R(!0),j(!1)},className:"px-3 py-2 text-sm hover:bg-gray-100 cursor-pointer",children:e.nama_sampah},e.id))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Berat (gram):"}),a.jsx("input",{type:"text",value:Number(g.berat||0).toLocaleString("id-ID"),onChange:e=>{const t=e.target.value.replace(/\./g,""),s=parseInt(t,10);l("berat",isNaN(s)?"":s)},inputMode:"numeric",placeholder:"Contoh: 2.500",className:"input w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-main"})]}),a.jsx("div",{className:"text-lg font-medium text-gray-800",children:a.jsxs("span",{className:"text-main font-bold",children:["Poin diperoleh: ",de().toLocaleString("id-ID")]})}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{type:"submit",disabled:S,className:`flex-1 py-3 rounded-lg font-semibold text-white transition ${S?"bg-gray-400 cursor-not-allowed":"bg-main hover:bg-main/90"}`,children:S?"Menyimpan...":"Submit"}),a.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-100 transition",children:"Cancel"})]})]}),a.jsx("div",{className:`sticky top-[44px] z-10 bg-white shadow px-4 py-3 border-b border-gray-200 ${H?"hidden":""}`,children:a.jsxs("div",{className:"flex space-x-4 items-center",children:[a.jsxs("div",{className:"flex-grow h-9 flex flex-row items-center justify-center pr-2 py-2 rounded-lg bg-neutral-100 border-2 border-gray-200",children:[a.jsx("input",{type:"text",placeholder:"Cari berdasarkan nama user atau jenis sampah...",value:w,onChange:e=>{te(e.target.value),$(1)},className:"bg-transparent border-none flex-grow focus:ring-0 focus:outline-none text-sm placeholder-gray-400"}),a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"0.3",className:"w-5 h-5 text-main",children:a.jsx("path",{d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zM9.5 14A4.5 4.5 0 1 1 14 9.5 4.505 4.505 0 0 1 9.5 14z"})})]}),a.jsx("button",{onClick:()=>oe(z==="asc"?"desc":"asc"),className:"flex items-center space-x-2 text-sm text-gray-700 hover:text-main transition",children:z==="asc"?a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6 text-main",children:[a.jsx("path",{d:"M6.75 2.25A.75.75 0 017.5 3v.75h9V3a.75.75 0 011.5 0v.75h.75A2.25 2.25 0 0121 6v12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18V6a2.25 2.25 0 012.25-2.25H6V3a.75.75 0 01.75-.75zM4.5 8.25v9.75a.75.75 0 00.75.75h13.5a.75.75 0 00.75-.75V8.25H4.5z"}),a.jsx("path",{fillRule:"evenodd",d:"M12 16a.75.75 0 01-.75-.75v-3.69l-1.22 1.22a.75.75 0 11-1.06-1.06l2.5-2.5a.75.75 0 011.06 0l2.5 2.5a.75.75 0 11-1.06 1.06l-1.22-1.22v3.69A.75.75 0 0112 16z",clipRule:"evenodd"})]}):a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6 text-main",children:[a.jsx("path",{d:"M6.75 2.25A.75.75 0 017.5 3v.75h9V3a.75.75 0 011.5 0v.75h.75A2.25 2.25 0 0121 6v12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18V6a2.25 2.25 0 012.25-2.25H6V3a.75.75 0 01.75-.75zM4.5 8.25v9.75a.75.75 0 00.75.75h13.5a.75.75 0 00.75-.75V8.25H4.5z"}),a.jsx("path",{fillRule:"evenodd",d:"M12 12a.75.75 0 01.75.75v3.69l1.22-1.22a.75.75 0 111.06 1.06l-2.5 2.5a.75.75 0 01-1.06 0l-2.5-2.5a.75.75 0 111.06-1.06l1.22 1.22v-3.69A.75.75 0 0112 12z",clipRule:"evenodd"})]})})]})}),a.jsx("div",{className:"p-4 grid grid-cols-1 gap-4 mt-12",children:q.length>0?q.map(e=>{var t,s,n,i,d,c,p,Y,Z;return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"flex flex-col bg-white rounded-lg shadow p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 flex items-center justify-center overflow-hidden",children:(t=e.sampah)!=null&&t.image?a.jsx("img",{src:`/storage/${e.sampah.image}`,alt:e.sampah.nama_sampah,className:"w-16 h-16 object-cover"}):a.jsx("img",{src:"/storage/logo.webp",alt:e.sampah.nama_sampah,className:"w-16 h-16 object-cover"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:`font-semibold text-base break-words max-w-[28vw] ${B===e.id?"line-clamp-none":"line-clamp-1"}`,onClick:()=>ae(B===e.id?null:e.id),children:(s=e.sampah)==null?void 0:s.nama_sampah}),U===e.id?a.jsx("input",{type:"text",className:"mt-1 text-sm border px-2 py-1 rounded w-full",value:y.berat_dalam_kg?(y.berat_dalam_kg*1e3).toLocaleString("id-ID"):"",onChange:ue=>{const J=ue.target.value.replace(/\D/g,"");N({...y,berat_dalam_kg:J?Number(J)/1e3:0})},inputMode:"numeric",pattern:"[0-9]*",placeholder:"Masukkan berat dalam gram"}):a.jsxs("div",{className:"text-sm text-gray-700",children:["Berat: ",a.jsxs("span",{className:"font-medium",children:[G(e.berat_dalam_kg*1e3)," gram"]})]}),a.jsxs("div",{className:"text-sm text-main font-bold",children:["Poin: ",G(e.poin_diperoleh)]})]}),a.jsx("div",{className:"flex flex-col space-y-1",children:U===e.id?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>ne(e.id),className:"text-xs bg-green-500 text-white px-2 py-1 rounded",children:"Simpan"}),a.jsx("button",{onClick:re,className:"text-xs bg-gray-300 text-gray-700 px-2 py-1 rounded",children:"Batal"})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>se(e),className:"text-xs text-yellow-700 bg-yellow-200 hover:bg-yellow-200 px-2 py-1 rounded-xl transition",children:"Edit"}),a.jsx("button",{onClick:()=>le(e.id),className:"text-xs text-red-700 bg-red-200 hover:bg-red-200 px-2 py-1 rounded-xl transition",children:"Hapus"})]})})]}),a.jsxs("div",{className:"flex justify-between space-x-2 text-xs text-gray-600",children:[a.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 px-1.5 py-0.5 rounded-full max-w-[65%] min-w-0",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"w-3.5 h-3.5 flex-shrink-0 text-gray-600",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 0 1-8 0 4 4 0 0 1 8 0Zm-8 6a6 6 0 0 0-6 6h20a6 6 0 0 0-6-6H8Z"})}),a.jsx(pe,{href:route("admin.manage-users.show",(n=e.user)==null?void 0:n.id),className:"block max-w-[11vw] truncate text-blue-600 hover:underline hover:text-blue-800 cursor-pointer",title:`${(i=e.user)==null?void 0:i.name}_RT:${(d=e.user)==null?void 0:d.rt}_RW:${(c=e.user)==null?void 0:c.rw}}`,children:a.jsxs("span",{className:"truncate block",children:[(p=e.user)==null?void 0:p.name," ",(Y=e.user)==null?void 0:Y.rt,"/",(Z=e.user)==null?void 0:Z.rw]})})]}),a.jsxs("div",{className:"flex items-center space-x-1 bg-gray-100 px-1.5 py-0.5 rounded-full whitespace-nowrap flex-shrink-0",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",className:"w-3.5 h-3.5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10m2 0a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2m14 0v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"})}),a.jsx("span",{children:me(e.tanggal)})]})]})]},e.id)})}):a.jsx("p",{className:"p-4 text-center text-gray-500",children:"Belum ada setoran."})}),k>1&&a.jsxs("div",{className:"flex justify-center space-x-2 pb-8",children:[a.jsx("button",{onClick:()=>I(o-1),disabled:o===1,className:"px-3 py-1 rounded border border-gray-300 disabled:opacity-50",children:"Prev"}),[...Array(k).keys()].map(e=>{const t=e+1;return a.jsx("button",{onClick:()=>I(t),className:`px-3 py-1 rounded border ${o===t?"bg-main text-white":"border-gray-300"}`,children:t},t)}),a.jsx("button",{onClick:()=>I(o+1),disabled:o===k,className:"px-3 py-1 rounded border border-gray-300 disabled:opacity-50",children:"Next"})]})]})}export{we as default};
